<ion-header>
  <ion-toolbar class="fancy-header">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="card-previa-page">
  <div class="container">

    <!-- Card de edição -->
    <ion-card class="editor">
      <ion-card-header>
        <ion-card-title>Edite sua Homenagem</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Título da Homenagem</ion-label>
          <ion-input placeholder="Digite o título" [(ngModel)]="titulo"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Mensagem</ion-label>
          <ion-textarea
            placeholder="Digite sua mensagem"
            [(ngModel)]="mensagem"
            autoGrow="true"
          ></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Link da Imagem (opcional)</ion-label>
          <ion-input placeholder="https://..." [(ngModel)]="imagemUrl"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Link Spotify (opcional)</ion-label>
          <ion-input
            placeholder="Cole o link da música"
            [(ngModel)]="spotifyUrl"
            (ionChange)="atualizarSpotify()"
          ></ion-input>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Preview da homenagem -->
    <ion-card class="preview-card">
      <ion-card-header>
        <ion-card-title>Pré-visualização</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <h2 class="titulo">{{ titulo || 'Seu título aqui' }}</h2>
        <p class="mensagem">{{ mensagem || 'Sua mensagem aparecerá aqui...' }}</p>

        <!-- IMAGEM -->
        <div class="imagem-container" *ngIf="imagemUrl">
          <img [src]="imagemUrl" alt="Imagem da homenagem" />
        </div>

        <!-- SPOTIFY -->
        <div class="spotify-container" *ngIf="sanitizedSpotifyUrl">
          <iframe
            [src]="sanitizedSpotifyUrl"
            width="100%"
            height="80"
            frameborder="0"
            allowtransparency="true"
            allow="encrypted-media"
          ></iframe>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Botões de gerar link e download -->
    <ion-button expand="full" color="primary" (click)="gerarLinkHomenagem()">
      Gerar Link da Homenagem
    </ion-button>

    <ion-button expand="full" color="success" [disabled]="!linkHomenagem" (click)="baixarHomenagem()">
      Baixar Homenagem
    </ion-button>

    <!-- Mostrar link gerado -->
    <ion-item *ngIf="linkHomenagem">
      <ion-label>Link da Homenagem:</ion-label>
      <a [href]="linkHomenagem" target="_blank">{{ linkHomenagem }}</a>
    </ion-item>

  </div>
</ion-content>

<ion-footer>
  <ion-toolbar class="footer-bar">
    <ion-title class="footer-text">
      © 2025 App Entre-nós. Todos os direitos reservados.
    </ion-title>
  </ion-toolbar>
</ion-footer>
